<!doctype html>
<html class="no-js" lang="en">

<head>
  <meta charset="utf-8">
  <title></title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon" href="/favicon.svg" />

  <!-- Place favicon.ico in the root directory -->

  <!-- <link rel="stylesheet" href="normalize.css"> -->
  <link rel="stylesheet" href="main.css">

  <link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css" rel="stylesheet">
  <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">

  <script src="./vendor/dist/esbuild/browser.js"></script>
</head>

<body class="mdc-typography">
  <hgroup>
    <h1 class="mdc-typography--headline1">Auth workflow tests</h1>
  </hgroup>
  <button class="mdc-button mdc-button--raised" data-mdc-auto-init="MDCRipple" onclick="googleLogin()">
    <span class="mdc-button__ripple"></span>
    <span class="mdc-button__touch"></span>
    <span class="mdc-button__label">Login Google</span>
  </button>
  <div id="tabs-forms" class="mdc-tab-bar" role="tablist" data-mdc-auto-init="MDCTabBar">
    <div class="mdc-tab-scroller">
      <div class="mdc-tab-scroller__scroll-area">
        <div class="mdc-tab-scroller__scroll-content">
          <button id="mdc-tab-0" class="mdc-tab" role="tab" aria-selected="true" tabindex="0">
            <span class="mdc-tab__content">
              <span class="mdc-tab__icon material-icons" aria-hidden="true">person</span>
              <span class="mdc-tab__text-label">Sing Up</span>
            </span>
            <span class="mdc-tab-indicator">
              <span class="mdc-tab-indicator__content mdc-tab-indicator__content--underline"></span>
            </span>
            <span class="mdc-tab__ripple"></span>
          </button>
          <button id="mdc-tab-1" class="mdc-tab" role="tab" aria-selected="true" tabindex="1">
            <span class="mdc-tab__content">
              <span class="mdc-tab__icon material-icons" aria-hidden="true">how_to_reg</span>
              <span class="mdc-tab__text-label">Confirm Sign Up</span>
            </span>
            <span class="mdc-tab-indicator">
              <span class="mdc-tab-indicator__content mdc-tab-indicator__content--underline"></span>
            </span>
            <span class="mdc-tab__ripple"></span>
          </button>
          <button id="mdc-tab-2" class="mdc-tab" role="tab" aria-selected="true" tabindex="2">
            <span class="mdc-tab__content">
              <span class="mdc-tab__icon material-icons" aria-hidden="true">login</span>
              <span class="mdc-tab__text-label">Sign In</span>
            </span>
            <span class="mdc-tab-indicator">
              <span class="mdc-tab-indicator__content mdc-tab-indicator__content--underline"></span>
            </span>
            <span class="mdc-tab__ripple"></span>
          </button>
          <button id="mdc-tab-3" class="mdc-tab" role="tab" aria-selected="true" tabindex="3">
            <span class="mdc-tab__content">
              <span class="mdc-tab__icon material-icons" aria-hidden="true">logout</span>
              <span class="mdc-tab__text-label">Sign Out</span>
            </span>
            <span class="mdc-tab-indicator">
              <span class="mdc-tab-indicator__content mdc-tab-indicator__content--underline"></span>
            </span>
            <span class="mdc-tab__ripple"></span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <form id="form-sign-up" class="mdc-layout-grid">
    <div class="mdc-layout-grid__inner">
      <div class="mdc-typography--headline6 mdc-layout-grid__cell--span-12">Sign Up</div>
      <div class="mdc-layout-grid__cell--span-12">
        <div class="mdc-form-field" data-mdc-auto-init="MDCFormField">
          <label id="sign-up-email" class="mdc-text-field mdc-text-field--filled" data-mdc-auto-init="MDCTextField">
            <span class="mdc-text-field__ripple"></span>
            <span class="mdc-floating-label" id="my-label-id">email</span>
            <input class="mdc-text-field__input" type="email" aria-labelledby="my-label-id" required>
            <span class="mdc-line-ripple"></span>
          </label>
        </div>
      </div>
      <div class="mdc-layout-grid__cell--span-12">
        <div class="mdc-form-field" data-mdc-auto-init="MDCFormField">
          <label id="sign-up-password" class="mdc-text-field mdc-text-field--filled" data-mdc-auto-init="MDCTextField">
            <span class="mdc-text-field__ripple"></span>
            <span class="mdc-floating-label" id="sign-up-password-id">password</span>
            <input class="mdc-text-field__input" type="password" aria-labelledby="sign-up-password-id" required>
            <span class="mdc-line-ripple"></span>
          </label>
          </div>
          </div>
          <div class="mdc-layout-grid__cell--span-12">
            <div class="mdc-form-field" data-mdc-auto-init="MDCFormField">
          <button class="mdc-button mdc-button--raised" data-mdc-auto-init="MDCRipple">
            <span class="mdc-button__ripple"></span>
            <span class="mdc-button__touch"></span>
            <span class="mdc-button__label">Sign Up</span>
          </button>
        </div>
      </div>
    </div>
  </form>

  <form id="form-sign-up-confirm" class="mdc-layout-grid">
    <div class="mdc-layout-grid__inner">
      <div class="mdc-typography--headline6 mdc-layout-grid__cell--span-12">Confirm Sign Up</div>
      <div class="mdc-layout-grid__cell--span-12">
        <div class="mdc-form-field" data-mdc-auto-init="MDCFormField">
          <label id="sign-up-confirm-email" class="mdc-text-field mdc-text-field--filled"
            data-mdc-auto-init="MDCTextField">
            <span class="mdc-text-field__ripple"></span>
            <span class="mdc-floating-label" id="my-confirm-label-id">email</span>
            <input class="mdc-text-field__input" type="email" aria-labelledby="my-confirm-label-id" required>
            <span class="mdc-line-ripple"></span>
          </label>
        </div>
      </div>
      <div class="mdc-layout-grid__cell--span-12">
        <div class="mdc-form-field" data-mdc-auto-init="MDCFormField">
          <label id="sign-up-confirm-code" class="mdc-text-field mdc-text-field--filled"
            data-mdc-auto-init="MDCTextField">
            <span class="mdc-text-field__ripple"></span>
            <span class="mdc-floating-label" id="my-confirm-label-code">code</span>
            <input class="mdc-text-field__input" type="number" aria-labelledby="my-confirm-label-code" required>
            <span class="mdc-line-ripple"></span>
          </label>
        </div>
      </div>
      <div class="mdc-layout-grid__cell--span-12">
        <div class="mdc-form-field" data-mdc-auto-init="MDCFormField">
          <button class="mdc-button mdc-button--raised" data-mdc-auto-init="MDCRipple">
            <span class="mdc-button__ripple"></span>
            <span class="mdc-button__touch"></span>
            <span class="mdc-button__label">Confirm</span>
          </button>
        </div>
      </div>
    </div>
  </form>

  <form id="form-sign-in" class="mdc-layout-grid">
    <div class="mdc-layout-grid__inner">
      <div class="mdc-typography--headline6 mdc-layout-grid__cell--span-12">Sign In</div>
      <div class="mdc-layout-grid__cell--span-12">
        <div class="mdc-form-field" data-mdc-auto-init="MDCFormField">
          <label id="sign-in-email" class="mdc-text-field mdc-text-field--filled" data-mdc-auto-init="MDCTextField">
            <span class="mdc-text-field__ripple"></span>
            <span class="mdc-floating-label" id="sign-in-label-id">email</span>
            <input class="mdc-text-field__input" type="email" aria-labelledby="sign-in-label-id" required>
            <span class="mdc-line-ripple"></span>
          </label>
        </div>
      </div>
      <div class="mdc-layout-grid__cell--span-12">
        <div class="mdc-form-field" data-mdc-auto-init="MDCFormField">
          <label id="sign-in-password" class="mdc-text-field mdc-text-field--filled" data-mdc-auto-init="MDCTextField">
            <span class="mdc-text-field__ripple"></span>
            <span class="mdc-floating-label" id="sign-in-password-id">password</span>
            <input class="mdc-text-field__input" type="password" aria-labelledby="sign-in-password-id" required>
            <span class="mdc-line-ripple"></span>
          </label>
        </div>
      </div>
      <div class="mdc-layout-grid__cell--span-12">
        <div class="mdc-form-field" data-mdc-auto-init="MDCFormField">
          <div class="mdc-checkbox mdc-checkbox--touch" data-mdc-auto-init="MDCCheckbox">
            <input type="checkbox" class="mdc-checkbox__native-control" id="checkbox-1" />
            <div class="mdc-checkbox__background">
              <svg class="mdc-checkbox__checkmark" viewBox="0 0 24 24">
                <path class="mdc-checkbox__checkmark-path" fill="none" d="M1.73,12.91 8.1,19.28 22.79,4.59" />
              </svg>
              <div class="mdc-checkbox__mixedmark"></div>
            </div>
            <div class="mdc-checkbox__ripple"></div>
          </div>
          <label for="checkbox-1">Remember Me</label>
        </div>
      </div>
      <div class="mdc-layout-grid__cell--span-12">
        <div class="mdc-form-field" data-mdc-auto-init="MDCFormField">
          <button class="mdc-button mdc-button--raised" data-mdc-auto-init="MDCRipple">
            <span class="mdc-button__ripple"></span>
            <span class="mdc-button__touch"></span>
            <span class="mdc-button__label">Sign In</span>
          </button>
        </div>
      </div>
    </div>
  </form>

  <form id="form-logout" class="mdc-layout-grid">
    <div class="mdc-layout-grid__inner">
      <div class="mdc-typography--headline6 mdc-layout-grid__cell--span-12">Logout</div>
      <div class="mdc-layout-grid__cell--span-12">
        <div class="mdc-form-field" data-mdc-auto-init="MDCFormField">
          <button class="mdc-button mdc-button--raised" data-mdc-auto-init="MDCRipple">
            <span class="mdc-button__ripple"></span>
            <span class="mdc-button__touch"></span>
            <span class="mdc-button__label">Logout</span>
          </button>
        </div>
      </div>
    </div>
  </form>

  <div class="mdc-card mdc-card--outlined">
    <div class="mdc-typography--headline6">User Info</div>
    <div class="mdc-card__content">
      <div class="info-entity">
        <span class="info-title mdc-typography--subtitle2 ">Login</span>
        <span id="info-login" class="info-content mdc-typography--body2"></span>
      </div>
      <div class="info-entity">
        <span class="info-title mdc-typography--subtitle2 ">Seed</span>
        <span id="info-seed" class="info-content mdc-typography--body2"></span>
      </div>
    </div>
  </div>

  <div id="my-signin2">
    <div style="height:50px;width:240px;" class="abcRioButton abcRioButtonBlue">
      <div class="abcRioButtonContentWrapper">
        <div class="abcRioButtonIcon" style="padding:15px">
          <div style="width:18px;height:18px;"
            class="abcRioButtonSvgImageWithFallback abcRioButtonIconImage abcRioButtonIconImage18"><svg version="1.1"
              xmlns="http://www.w3.org/2000/svg" width="18px" height="18px" viewBox="0 0 48 48" class="abcRioButtonSvg">
              <g>
                <path fill="#EA4335"
                  d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z">
                </path>
                <path fill="#4285F4"
                  d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z">
                </path>
                <path fill="#FBBC05"
                  d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z">
                </path>
                <path fill="#34A853"
                  d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z">
                </path>
                <path fill="none" d="M0 0h48v48H0z"></path>
              </g>
            </svg></div>
        </div><span style="font-size:16px;line-height:48px;" class="abcRioButtonContents"><span
            id="not_signed_in2rumyjxd44rb">Sign in with Google</span><span id="connected2rumyjxd44rb"
            style="display:none">Signed in with Google</span></span>
      </div>
    </div>
  </div>

  <aside id="status-bar" class="mdc-snackbar" data-mdc-auto-init="MDCSnackbar">
    <div class="mdc-snackbar__surface" role="status" aria-relevant="additions">
      <div class="mdc-snackbar__label" aria-atomic="false">
        Can't send photo. Retry in 5 seconds.
      </div>
      <div class="mdc-snackbar__actions" aria-atomic="true">
        <button type="button" class="mdc-button mdc-snackbar__action">
          <div class="mdc-button__ripple"></div>
          <span class="mdc-button__label">OK</span>
        </button>
      </div>
    </div>
  </aside>

  <script type="text/javascript">
    window.mdc.autoInit()
    const COOKIE_NAME = 'formEmail'
    getEmailAndPropagate();

      window.Auth.on('signIn', (data) => loggedIn(true))
      window.Auth.on('autoSignIn', (data) => loggedIn(true))
      window.Auth.on('signOut', (data) => loggedIn(false))

      let events = [
        'signIn',
        'signUp',
        'signOut',
        'signIn_failure',
        'tokenRefresh',
        'tokenRefresh_failure',
        'autoSignIn',
        'autoSignIn_failure',
        'configured',
        'signUp_failure',
        'signOut_failure'
      ]
      events.forEach(event => {
        window.Auth.on(event, (data) => setStatus(event))
      });

    const statusBar = new mdc.snackbar.MDCSnackbar(document.getElementById('status-bar'));
    const statusMessages = []
    statusBar.listen('MDCSnackbar:closed', (e) => {
      if (statusMessages.length > 0) setStatus();
    })

    const tabs = new mdc.tabBar.MDCTabBar(document.getElementById('tabs-forms'));
    tabs.listen('MDCTabBar:activated', (e) => changeTab(e.detail.index))

    const formSignUp = document.getElementById('form-sign-up');
    formSignUp.onsubmit = (e) => {
      e.preventDefault();
      signup()
    }
    const formSignUpConfirm = document.getElementById('form-sign-up-confirm');
    formSignUpConfirm.onsubmit = (e) => {
      e.preventDefault();
      signupConfirm()
    }
    const formSignIn = document.getElementById('form-sign-in');
    formSignIn.onsubmit = (e) => {
      e.preventDefault();
      signin()
    }
    const formLogout = document.getElementById('form-logout');
    formLogout.onsubmit = (e) => {
      e.preventDefault();
      logout()
    }

    const changeTab = (index) => {
      switch (index) {
        case 0:
          formHide(formSignIn)
          formHide(formSignUpConfirm)
          formShow(formSignUp)
          formHide(formLogout)
          break;
        case 1:
          formHide(formSignIn)
          formShow(formSignUpConfirm)
          formHide(formSignUp)
          formHide(formLogout)
          break;
        case 2:
          formShow(formSignIn)
          formHide(formSignUpConfirm)
          formHide(formSignUp)
          formHide(formLogout)
          break;
        case 3:
          formHide(formSignIn)
          formHide(formSignUpConfirm)
          formHide(formSignUp)
          formShow(formLogout)
          break;
        default:
          formHide(formSignIn)
          formHide(formSignUpConfirm)
          formHide(formSignUp)
          formHide(formLogout)
          break;
      }
    }

    const setStatus = (text) => {
      if (text) statusMessages.push(text);
      if (statusBar.isOpen) return;

      const msg = statusMessages.shift();
      statusBar.labelText = msg
      statusBar.open()
    }

    const signup = () => {
      let email = getValueById("sign-up-email")
      let password = getValueById("sign-up-password")
      setEmail(email)
      document.cookie = `${COOKIE_NAME}=${email}`
      // setStatus(`OK ${email}`)

      window.Auth.signUp(email, password)
        // .then(() => setStatus(`OK: Signed Up`))
        .catch((e) => setStatus(`ERROR: Signed Up: ${JSON.stringify(e)}`))
    }
    const signin = () => {
      let email = getValueById("sign-in-email")
      let password = getValueById("sign-in-password")
      // setStatus(`OK ${email}, ${password}`)

      window.Auth.signIn(email, password)
        // .then(() => setStatus(`OK: Signed In`))
        .catch((e) => setStatus(`ERROR: Signed In: ${JSON.stringify(e)}`))
    }
    const signupConfirm = () => {
      let email = getValueById("sign-up-confirm-email")
      let code = getValueById("sign-up-confirm-code")
      // setStatus(`Confirm: ${email}, ${code}`)

      window.Auth.confirmSignUp(email, code)
        // .then(() => setStatus(`OK: Sign Up Confirmed`))
        .catch((e) => setStatus(`ERROR: Sign Up Confirmation: ${JSON.stringify(e)}`))
    }
    const logout = () => {
      // setStatus(`Logout`)
      window.Auth.signOut()
        // .then(() => setStatus(`OK: Logged Out`))
        .catch((e) => setStatus(`ERROR: Logged Out: ${JSON.stringify(e)}`))
    }

    // Init visibility
    tabs.activateTab(0)

    function getValueById(id) {
      let field = new mdc.textField.MDCTextField(document.getElementById(id));
      return field.value
    }
    function setValueById(id, value) {
      let field = new mdc.textField.MDCTextField(document.getElementById(id));
      field.value = value
    }

    function formHide(form) {
      form.style.display = "none"
    }
    function formShow(form) {
      form.style.display = ""
    }

    function setEmail(email) {
      setValueById('sign-in-email', email)
      setValueById('sign-up-confirm-email', email)
    }

  function getEmailAndPropagate() {
    let email = document.cookie
      .split('; ')
      .find((row) => row.startsWith(`${COOKIE_NAME}=`))
      ?.split('=')[1];
    if (email) {
      setValueById('sign-up-email', email)
      setValueById('sign-up-confirm-email', email)
      setValueById('sign-in-email', email)
    }
  }

  // update interface; boolean
  function loggedIn(value) {
    let tabs = [
      // sign up
      document.getElementById("mdc-tab-0"),
      // sign confirm
      document.getElementById("mdc-tab-1"),
      // sign sign in
      document.getElementById("mdc-tab-2"),
      // sign logout
      document.getElementById("mdc-tab-3"),
    ]
    let field = new mdc.tabBar.MDCTabBar(document.getElementById("tabs-forms"));
    if (value) {
      // if logged in
      tabs[0].style.display = "none"
      tabs[1].style.display = "none"
      tabs[2].style.display = "none"
      tabs[3].style.display = ""
      field.tabList[3].handleClick()
    } else {
      // if logged out
      tabs[0].style.display = ""
      tabs[1].style.display = ""
      tabs[2].style.display = ""
      tabs[3].style.display = "none"
      field.tabList[0].handleClick()
    }
    setUserInfo()
  }

  function setUserInfo() {
    if (Auth.user) {
      const displayName = Auth.user.displayName
      const email = Auth.user.email
      document.getElementById('info-login').innerText = displayName || email
      Auth.showSeed().then(s => document.getElementById('info-seed').innerText = s)
    } else {
      document.getElementById('info-login').innerText = ''
      document.getElementById('info-seed').innerText = ''
    }
  }

  function googleLogin() {
    Auth.loginGoogle()
  }

  </script>
</body>

</html>
